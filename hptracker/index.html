<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .health-bar {
      background: linear-gradient(to right, #dc2626, #b91c1c, #dc2626);
      height: 100%;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: width 0.2s ease-in-out;
    }
    .character-container {
      min-height: 60px;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      border: 2px solid #facc15;
      border-radius: 8px;
      transition: border-color 0.2s ease-in-out;
      cursor: pointer;
    }
    .character-container.selected {
      border-color: #facc15;
    }
    .character-container:not(.selected) {
      border-color: rgba(250, 204, 21, 0);
    }
    .portrait {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #4b5563;
      display: block;
      transition: opacity 0.2s ease-in-out, filter 0.2s ease-in-out;
    }
    .portrait[src=""], .portrait:not([src]) {
      visibility: hidden;
    }
    #character-list {
      display: flex;
      gap: 1rem;
    }
    .column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .hp-change {
      margin-left: 0.5rem;
      color: white;
      font-size: 1rem;
      font-weight: bold;
      animation: bounce 0.4s ease-in-out;
    }
    .dead .name, .dead .hp-text, .dead .portrait {
      opacity: 0.5;
    }
    .dead .name {
      text-decoration: line-through;
    }
    .dead .portrait {
      filter: grayscale(100%);
    }
    @keyframes bounce {
      0% { transform: scale(1); }
      50% { transform: scale(1.5); }
      100% { transform: scale(1); }
    }
    @media (max-height: 600px) {
      .character-container {
        min-height: 48px;
      }
      .text-lg {
        font-size: 0.9rem;
      }
      .text-sm {
        font-size: 0.7rem;
      }
      .h-5 {
        height: 0.75rem;
      }
      .column {
        gap: 0.375rem;
      }
      .hp-change {
        font-size: 0.8rem;
      }
    }
    @media (max-height: 400px) {
      .character-container {
        min-height: 36px;
      }
      .text-lg {
        font-size: 0.75rem;
      }
      .text-sm {
        font-size: 0.6rem;
      }
      .h-5 {
        height: 0.5rem;
      }
      .column {
        gap: 0.125rem;
      }
      .hp-change {
        font-size: 0.7rem;
      }
    }
    @media (max-height: 300px) {
      .character-container {
        min-height: 28px;
      }
      .text-lg {
        font-size: 0.65rem;
      }
      .text-sm {
        font-size: 0.5rem;
      }
      .h-5 {
        height: 0.4rem;
      }
      .column {
        gap: 0.125rem;
      }
      .hp-change {
        font-size: 0.6rem;
      }
    }
  </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-2">
  <div class="w-full max-w-4xl">
    <div id="character-list">
      <div class="column">
        <!-- Zendith -->
        <div class="character-container p-2" id="char-0">
          <img src="1.png" alt="" class="portrait">
          <div class="flex-1">
            <div class="flex items-center">
              <div class="text-lg font-semibold name">Zendith</div>
              <div class="hp-change" id="hp-change-0"></div>
            </div>
            <div class="w-full bg-gray-700 rounded h-5">
              <div class="health-bar" id="health-0"></div>
            </div>
            <div class="text-sm text-gray-300 hp-text" id="hp-0"></div>
          </div>
        </div>
        <!-- Feathers -->
        <div class="character-container p-2" id="char-2">
          <img src="3.png" alt="" class="portrait">
          <div class="flex-1">
            <div class="flex items-center">
              <div class="text-lg font-semibold name">Feathers</div>
              <div class="hp-change" id="hp-change-2"></div>
            </div>
            <div class="w-full bg-gray-700 rounded h-5">
              <div class="health-bar" id="health-2"></div>
            </div>
            <div class="text-sm text-gray-300 hp-text" id="hp-2"></div>
          </div>
        </div>
        <!-- Batula -->
        <div class="character-container p-2" id="char-4">
          <img src="5.png" alt="" class="portrait">
          <div class="flex-1">
            <div class="flex items-center">
              <div class="text-lg font-semibold name">Batula</div>
              <div class="hp-change" id="hp-change-4"></div>
            </div>
            <div class="w-full bg-gray-700 rounded h-5">
              <div class="health-bar" id="health-4"></div>
            </div>
            <div class="text-sm text-gray-300 hp-text" id="hp-4"></div>
          </div>
        </div>
      </div>
      <div class="column">
        <!-- Terra -->
        <div class="character-container p-2" id="char-1">
          <img src="2.png" alt="" class="portrait">
          <div class="flex-1">
            <div class="flex items-center">
              <div class="text-lg font-semibold name">Terra</div>
              <div class="hp-change" id="hp-change-1"></div>
            </div>
            <div class="w-full bg-gray-700 rounded h-5">
              <div class="health-bar" id="health-1"></div>
            </div>
            <div class="text-sm text-gray-300 hp-text" id="hp-1"></div>
          </div>
        </div>
        <!-- Immeral -->
        <div class="character-container p-2" id="char-3">
          <img src="4.png" alt="" class="portrait">
          <div class="flex-1">
            <div class="flex items-center">
              <div class="text-lg font-semibold name">Immeral</div>
              <div class="hp-change" id="hp-change-3"></div>
            </div>
            <div class="w-full bg-gray-700 rounded h-5">
              <div class="health-bar" id="health-3"></div>
            </div>
            <div class="text-sm text-gray-300 hp-text" id="hp-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const characters = [
      { name: "Zendith", maxHP: 20, currentHP: 20, changeCounter: 0, changeTimeout: null },
      { name: "Terra", maxHP: 18, currentHP: 18, changeCounter: 0, changeTimeout: null },
      { name: "Feathers", maxHP: 28, currentHP: 28, changeCounter: 0, changeTimeout: null },
      { name: "Immeral", maxHP: 23, currentHP: 23, changeCounter: 0, changeTimeout: null },
      { name: "Batula", maxHP: 21, currentHP: 21, changeCounter: 0, changeTimeout: null }
    ];

    const navOrder = [0, 2, 4, 1, 3]; // Navigation order: Zendith(0), Feathers(2), Batula(4), Terra(1), Immeral(3)
    let selectedNavIndex = -1; // Tracks position in navOrder

    function renderCharacters() {
      characters.forEach((char, index) => {
        const percentage = (char.currentHP / char.maxHP) * 100;
        const charElement = document.getElementById(`char-${index}`);
        const healthElement = document.getElementById(`health-${index}`);
        const hpElement = document.getElementById(`hp-${index}`);
        const nameElement = charElement.querySelector('.name');
        const portraitElement = charElement.querySelector('.portrait');
        charElement.className = `character-container p-2 ${navOrder[selectedNavIndex] === index ? "selected" : ""} ${char.currentHP === 0 ? "dead" : ""}`;
        healthElement.style.width = `${percentage}%`;
        hpElement.textContent = `${char.currentHP}/${char.maxHP} HP`;
      });
    }

    function updateHealth(change) {
      if (selectedNavIndex === -1) return; // No action if no character is selected
      const charIndex = navOrder[selectedNavIndex];
      const char = characters[charIndex];
      if (change > 0 && char.currentHP === char.maxHP) return; // No increase if at max HP
      char.currentHP = Math.max(0, Math.min(char.maxHP, char.currentHP + change));
      const hpChangeElement = document.getElementById(`hp-change-${charIndex}`);
      char.changeCounter += change;
      hpChangeElement.textContent = `${char.changeCounter > 0 ? "+" : ""}${char.changeCounter}`;
      hpChangeElement.style.display = "inline-block";
      // Force re-trigger of animation
      hpChangeElement.classList.remove('hp-change');
      void hpChangeElement.offsetWidth; // Trigger reflow
      hpChangeElement.classList.add('hp-change');
      
      // Clear existing timeout
      if (char.changeTimeout) clearTimeout(char.changeTimeout);
      
      // Set new timeout to hide change text
      char.changeTimeout = setTimeout(() => {
        hpChangeElement.style.display = "none";
        char.changeCounter = 0;
      }, 1000);

      renderCharacters();
    }

    function selectCharacter(navIndex) {
      // Hide HP change text for previously selected character
      if (selectedNavIndex !== -1) {
        const prevCharIndex = navOrder[selectedNavIndex];
        const prevHpChangeElement = document.getElementById(`hp-change-${prevCharIndex}`);
        if (prevHpChangeElement) {
          prevHpChangeElement.style.display = "none";
          characters[prevCharIndex].changeCounter = 0;
          if (characters[prevCharIndex].changeTimeout) {
            clearTimeout(characters[prevCharIndex].changeTimeout);
          }
        }
      }
      selectedNavIndex = Math.max(-1, Math.min(navOrder.length - 1, navIndex));
      renderCharacters();
    }

    function deselectCharacter() {
      if (selectedNavIndex !== -1) {
        const prevCharIndex = navOrder[selectedNavIndex];
        const prevHpChangeElement = document.getElementById(`hp-change-${prevCharIndex}`);
        if (prevHpChangeElement) {
          prevHpChangeElement.style.display = "none";
          characters[prevCharIndex].changeCounter = 0;
          if (characters[prevCharIndex].changeTimeout) {
            clearTimeout(characters[prevCharIndex].changeTimeout);
          }
        }
        selectedNavIndex = -1;
        renderCharacters();
      }
    }

    document.addEventListener("keydown", (e) => {
      e.preventDefault();
      if (e.key === "Escape") {
        deselectCharacter();
      } else if (e.key >= "1" && e.key <= "5") {
        selectCharacter(parseInt(e.key) - 1);
      } else if (e.key === "ArrowUp") {
        if (selectedNavIndex === -1) {
          selectCharacter(navOrder.length - 1); // Select Immeral
        } else if (selectedNavIndex === 0) {
          deselectCharacter(); // Deselect if on Zendith
        } else {
          selectCharacter(selectedNavIndex - 1);
        }
      } else if (e.key === "ArrowDown") {
        if (selectedNavIndex === -1) {
          selectCharacter(0); // Select Zendith
        } else if (selectedNavIndex === navOrder.length - 1) {
          deselectCharacter(); // Deselect if on Immeral
        } else {
          selectCharacter(selectedNavIndex + 1);
        }
      } else if (e.key === "ArrowLeft") {
        updateHealth(-1);
      } else if (e.key === "ArrowRight") {
        updateHealth(1);
      }
    });

    document.addEventListener("click", (e) => {
      const charContainer = e.target.closest('.character-container');
      if (charContainer) {
        const index = parseInt(charContainer.id.split('-')[1]);
        const navIndex = navOrder.indexOf(index);
        selectCharacter(navIndex);
      } else {
        deselectCharacter();
      }
    });

    // Initial render
    renderCharacters();
  </script>
</body>
</html>