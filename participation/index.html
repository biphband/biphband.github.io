<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Participation Points</title>
      <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="menu-icon" onclick="enterTeacherMode()">â˜°</div>
    <div id="header">
        <div id="objective">
            <h3>Objective:</h3>
            <ul id="objectiveList">
                <li class="editable" onclick="editObjective(this)">Instrument fundamentals</li>
                <li class="editable" onclick="editObjective(this)">Sectionals, new music</li>
                <li class="editable" onclick="editObjective(this)">Tutoring on the weekends</li>
            </ul>
        </div>
        <div id="title">
            <h1>MS Band</h1>
            <h2 id="timeRange">12:40 - 1:30</h2>
        </div>
        <div id="date">
            <p><h3>Date:</h3></p>
            <p><span id="currentDate"></span></p>
            <p><span id="currentDay"></span></p>
        </div>
    </div>
    <div id="graph-container">
        <button class="copy-button" onclick="copyScores()">Copy Scores</button>
    </div>
    <div id="teacher-mode">
        <span class="close-button" onclick="exitTeacherMode()">&times;</span>
        <button class="reset-button" onclick="resetAllStudents()">Reset All</button>
        <div class="spreadsheet">
            <div class="spreadsheet-header"><strong>Student</strong></div>
            <div class="spreadsheet-header"><strong onclick="cycleAttendance()">Attendance</strong></div>
            <div class="spreadsheet-header"><strong onclick="toggleAllCheckboxes('stands')">Stands</strong></div>
            <div class="spreadsheet-header"><strong onclick="toggleAllCheckboxes('music')">Music</strong></div>
            <div class="spreadsheet-header"><strong onclick="toggleAllCheckboxes('pencils')">Pencils</strong></div>
            <div class="spreadsheet-header"><strong onclick="toggleAllCheckboxes('cases')">Cases</strong></div>
            <div class="spreadsheet-header"><strong>Participation</strong></div>
        </div>
    </div>
    <div id="floating-menu" class="floating-menu"></div>

    <script>
        const students = [
            'Anne', 'Kevin', 'Shine', 'Sophie', 'Owen', 'Helen H', 'Haefen', 'Leo', 'Francis', 'Mianmian', 
            'Steven', 'Helen N', 'Jenny', 'Grace', 'June', 'Rene', 'Steve', 'Bruce', 'Calvin Y', 'Luna', 
            'Calvin Z', 'Aurora'
        ].map(name => ({ name, score: 'EX', attendance: 'Absent', stands: false, music: false, pencils: false, cases: false }));

        const teacherModeOrder = [
            'Shine', 'Jenny', 'June', 'Leo', 'Grace', 'Mianmian', 'Helen H', 'Anne', 'Calvin Y', 'Francis',
            'Steve', 'Owen', 'Haefen', 'Sophie', 'Steven', 'Calvin Z', 'Helen N', 'Luna', 'Rene', 'Bruce',
            'Aurora', 'Kevin'
        ];

        function populateStudents() {
            const spreadsheet = document.querySelector('.spreadsheet');
            teacherModeOrder.forEach(name => {
                const student = students.find(s => s.name === name);
                const row = document.createElement('div');
                row.className = 'spreadsheet-row';
                row.dataset.studentName = student.name;
                row.innerHTML = `
                    <div>${student.name}</div>
                    <div class="attendance-dropdown">
                        <select onchange="syncAttendance('${student.name}', this)">
                            <option value="Absent" ${student.attendance === 'Absent' ? 'selected' : ''}>Absent</option>
                            <option value="Present" ${student.attendance === 'Present' ? 'selected' : ''}>Present</option>
                            <option value="Tardy" ${student.attendance === 'Tardy' ? 'selected' : ''}>Tardy</option>
                        </select>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" ${student.stands ? 'checked' : ''} onchange="syncCheckbox('${student.name}', this, 'stands')"> 
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" ${student.music ? 'checked' : ''} onchange="syncCheckbox('${student.name}', this, 'music')"> 
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" ${student.pencils ? 'checked' : ''} onchange="syncCheckbox('${student.name}', this, 'pencils')"> 
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" ${student.cases ? 'checked' : ''} onchange="syncCheckbox('${student.name}', this, 'cases')"> 
                    </div>
                    <div class="stepper">
                        <button onclick="updateScore('${student.name}', -10)">-</button>
                        <span>${student.score}</span>
                        <button onclick="updateScore('${student.name}', 10)">+</button>
                    </div>
                `;
                spreadsheet.appendChild(row);
            });
        }

        function enterTeacherMode() {
            const teacherMode = document.getElementById('teacher-mode');
            if (teacherMode.style.display === 'block') {
                exitTeacherMode();
            } else {
                teacherMode.style.display = 'block';
                populateStudents();
            }
        }

        function exitTeacherMode() {
            document.getElementById('teacher-mode').style.display = 'none';
            document.querySelector('.spreadsheet').innerHTML = ''; 
        }

        function syncAttendance(name, select) {
            const student = students.find(s => s.name === name);
            if (student) {
                student.attendance = select.value;
                calculateScore(student);
                updateScoreDisplay(student);
            }
        }

        function syncCheckbox(name, checkbox, type) {
            const student = students.find(s => s.name === name);
            if (student) {
                student[type] = checkbox.checked;
                calculateScore(student);
                updateScoreDisplay(student);
            }
        }

        function updateScore(name, change) {
            const student = students.find(s => s.name === name);
            if (student && student.score !== 'EX') {
                student.score = Math.max(0, Math.min(100, parseInt(student.score) + change));
                updateScoreDisplay(student);
                
                const bar = document.getElementById(`bar-${name}`);
                bar.style.animation = 'none';
                bar.offsetHeight; // Trigger reflow
                bar.style.animation = change > 0 ? 'flash-green 0.5s' : 'flash-red 0.5s';
            }
        }

        function calculateScore(student) {
            if (student.attendance === 'Absent') {
                student.score = 'EX';
            } else {
                let score = 60; 
                if (student.attendance === 'Tardy') score -= 20;
                if (student.stands) score += 10;
                if (student.music) score += 10;
                if (student.pencils) score += 10;
                if (student.cases) score += 10;
                student.score = Math.max(0, Math.min(100, score));
            }
        }

        function updateScoreDisplay(student) {
            const bar = document.getElementById(`bar-${student.name}`);
            if (bar) {
                if (student.score === 'EX') {
                    bar.style.height = '0%';
                    bar.querySelector('.bar-label').innerHTML = `${student.name}<br>EX`;
                } else {
                    bar.style.height = `${student.score}%`;
                    bar.querySelector('.bar-label').innerHTML = `${student.name}<br>${student.score}%`;
                }
            }
            const participationSpan = document.querySelector(`.spreadsheet-row[data-student-name="${student.name}"] .stepper span`);
            if (participationSpan) {
                participationSpan.textContent = student.score === 'EX' ? 'EX' : `${student.score}%`;
            }
        }

        function createBars() {
            const container = document.getElementById('graph-container');
            students.forEach(student => {
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = student.score === 'EX' ? '0%' : `${student.score}%`;
                bar.id = `bar-${student.name}`;
                
                const label = document.createElement('div');
                label.className = 'bar-label';
                label.innerHTML = `${student.name}<br>${student.score === 'EX' ? 'EX' : student.score + '%'}`;
                
                bar.appendChild(label);
                bar.addEventListener('mouseover', () => highlightBar(student.name));
                bar.addEventListener('mouseout', resetBarHighlights);
                bar.addEventListener('click', (event) => showFloatingMenu(event, student.name));
                container.appendChild(bar);
            });
        }

        function highlightBar(name) {
            document.querySelectorAll('.bar, .bar-label').forEach(el => {
                if (el.id === `bar-${name}` || el.parentElement.id === `bar-${name}`) {
                    el.style.opacity = '1';
                } else {
                    el.style.opacity = '0.5';
                }
            });
        }

        function resetBarHighlights() {
            document.querySelectorAll('.bar, .bar-label').forEach(el => {
                el.style.opacity = '1';
            });
        }

        function showFloatingMenu(event, name) {
            const floatingMenu = document.getElementById('floating-menu');
            const student = students.find(s => s.name === name);
            
            floatingMenu.innerHTML = `
                <h3>${student.name}</h3>
                <select onchange="syncAttendance('${student.name}', this)">
                    <option value="Absent" ${student.attendance === 'Absent' ? 'selected' : ''}>Absent</option>
                    <option value="Present" ${student.attendance === 'Present' ? 'selected' : ''}>Present</option>
                    <option value="Tardy" ${student.attendance === 'Tardy' ? 'selected' : ''}>Tardy</option>
                </select>
                <label><input type="checkbox" ${student.stands ? 'checked' : ''} onchange="syncCheckbox('${student.name}', this, 'stands')"> Stands</label>
                <label><input type="checkbox" ${student.music ? 'checked' : ''} onchange="syncCheckbox('${student.name}', this, 'music')"> Music</label>
                <label><input type="checkbox" ${student.pencils ? 'checked' : ''} onchange="syncCheckbox('${student.name}', this, 'pencils')"> Pencils</label>
                <label><input type="checkbox" ${student.cases ? 'checked' : ''} onchange="syncCheckbox('${student.name}', this, 'cases')"> Cases</label>
                <div class="stepper">
                    <button onclick="updateScore('${student.name}', -10)">-</button>
                    <span>${student.score}</span>
                    <button onclick="updateScore('${student.name}', 10)">+</button>
                </div>
                <button onclick="closeFloatingMenu()">Close</button>
            `;
            
            floatingMenu.style.display = 'block';
            floatingMenu.style.left = `${event.clientX}px`;
            floatingMenu.style.top = `${event.clientY}px`;
        }

        function closeFloatingMenu() {
            document.getElementById('floating-menu').style.display = 'none';
        }

        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('currentDay').textContent = now.toLocaleDateString('en-US', { weekday: 'long' });
        }

        function editObjective(item) {
            const currentItem = item.textContent;
            const newItem = prompt('Edit objective:', currentItem);
            if (newItem !== null) {
                item.textContent = newItem.trim();
            }
        }

        function cycleAttendance() {
            const attendanceOptions = ['Absent', 'Present', 'Tardy'];
            const currentIndex = attendanceOptions.indexOf(students[0].attendance);
            const nextIndex = (currentIndex + 1) % attendanceOptions.length;
            const nextAttendance = attendanceOptions[nextIndex];
            
            students.forEach(student => {
                student.attendance = nextAttendance;
                calculateScore(student);
                updateScoreDisplay(student);
            });

            document.querySelectorAll('.attendance-dropdown select').forEach(select => {
                select.value = nextAttendance;
            });
        }

        function toggleAllCheckboxes(type) {
            const checkboxes = document.querySelectorAll(`.spreadsheet .checkbox-container input[type="checkbox"]`);
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            checkboxes.forEach((cb, index) => {
                if (index % 4 === ['stands', 'music', 'pencils', 'cases'].indexOf(type)) {
                    cb.checked = !allChecked;
                    const studentName = teacherModeOrder[Math.floor(index / 4)];
                    syncCheckbox(studentName, cb, type);
                }
            });
        }
        

function copyScores() {
    const scores = students.map(student => 
        student.score === 'EX' ? 'EX' : `${student.score}%`
    );

    // Create an HTML table for clipboard
    const htmlTable = `
        <table style="border-collapse: collapse; font-family: 'Arial Narrow'; font-size: 22pt;">
            <tr>
                ${scores.map(score => `<td style="border: 2pt solid black;">${score}</td>`).join('')}
            </tr>
        </table>
    `;

    // Use the clipboard API to copy the HTML
    navigator.clipboard.write([
        new ClipboardItem({
            'text/html': new Blob([htmlTable], { type: 'text/html' }),
            'text/plain': new Blob([scores.join('\t')], { type: 'text/plain' }) // Fallback for plain text
        })
    ]).then(() => {
        alert('Scores copied to clipboard');
    }).catch(err => {
        console.error('Failed to copy scores: ', err);
    });
}

        function resetAllStudents() {
            students.forEach(student => {
                student.attendance = 'Absent';
                student.stands = false;
                student.music = false;
                student.pencils = false;
                student.cases = false;
                student.score = 'EX';
                updateScoreDisplay(student);
            });

            document.querySelectorAll('.attendance-dropdown select').forEach(select => {
                select.value = 'Absent';
            });

            document.querySelectorAll('.checkbox-container input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        createBars();
        updateDateTime();
        setInterval(updateDateTime, 1000);   

        document.addEventListener('click', function(event) {
            const teacherMode = document.getElementById('teacher-mode');
            const floatingMenu = document.getElementById('floating-menu');
            if (!teacherMode.contains(event.target) && teacherMode.style.display === 'block' && !event.target.closest('.menu-icon')) {
                exitTeacherMode();
            }
            if (!floatingMenu.contains(event.target) && floatingMenu.style.display === 'block' && !event.target.closest('.bar')) {
                closeFloatingMenu();
            }
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                exitTeacherMode();
                closeFloatingMenu();
            }
        });
    </script>
</body>
</html>
